<?php

$linkprx = 'https://lumtest.com/myip.json';

function testProxy($linkprx, $proxyData, $type) {
    $ch = curl_init($linkprx);

    if ($type == 'http') {
        $proxy = $proxyData['ip'] . ':' . $proxyData['port'];
        curl_setopt_array($ch, [
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_PROXY => $proxy,
            CURLOPT_TIMEOUT => 2,
            CURLOPT_HTTPGET => true,
            CURLOPT_CONNECTTIMEOUT => 5,
        ]);
    } elseif ($type == 'http_with_auth') {
        $proxy = $proxyData['ip'] . ':' . $proxyData['port'];
        $userpass = $proxyData['userpass'];
        curl_setopt_array($ch, [
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_PROXY => $proxy,
            CURLOPT_PROXYUSERPWD => $userpass,
            CURLOPT_TIMEOUT => 2,
            CURLOPT_HTTPGET => true,
            CURLOPT_CONNECTTIMEOUT => 5,
        ]);
    }

    $ipData = curl_exec($ch);
    $info = curl_getinfo($ch);
    curl_close($ch);

    return $ipData;
}

$ip = "Inactive!";

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $proxyList = explode("\n", $_POST["proxyList"]);
    $proxyType = $_POST["proxyType"];
    
    if ($proxyType === "http") {
        $type = "http";
    } elseif ($proxyType === "http_with_auth") {
        $type = "http_with_auth";
    }
    
    foreach ($proxyList as $proxy) {
        $proxyData = getProxy([$proxy], $type);
        $ipData = testProxy($linkprx, $proxyData, $type);
        
        if ($ipData) {
            $ip = "Proxy is LIVE: $ipData";
        } else {
            $ip = "Proxy is DEAD: $ipData";
        }
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Proxy Checker</title>
</head>
<body>
    <h1>Proxy Checker</h1>
    
    <form method="POST">
        <label for="proxyList">Enter proxy list (one per line):</label><br>
        <textarea id="proxyList" name="proxyList" rows="10" cols="30"></textarea><br>
        
        <label for="proxyType">Select proxy type:</label>
        <select id="proxyType" name="proxyType">
            <option value="http">HTTP</option>
            <option value="http_with_auth">HTTP with Auth</option>
        </select><br>
        
        <button type="submit">Check Proxies</button>
    </form>
    
    <?php echo $ip; ?>
</body>
</html>
